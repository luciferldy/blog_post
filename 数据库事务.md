+++
date = "2015-04-19T08:46:07+08:00"
menu = "main"
tags = ["database"]
title = "数据库事务"

+++

事务（Transaction）是并发控制的基本单位。所谓的事务，它是一个操作序列，要么都不执行，要么都执行，它是一个不可分割的工作单位。事务是数据库维护数据一致性的单位，在每个事务结束时，都能保持数据的一致性。  

事务具有以下4个基本特征：  

1. Atomic（原子性）：事务中包含的操作被看做一个逻辑单元，这个逻辑单元中的操作要么全部成功，要么全部失败。  
2. Consistency（一致性）：只有合法de数据可以被写入数据库，否则事务应该回滚到最初状态。  
3. Isolation（隔离性）：事务允许多个用户对同一数据进行并发访问，而不破坏数据的正确性和完整性。同时，并行数据的修改不许和其他并行事务的修改相独立。  
4. Durability（持久性）：事务结束后，书屋处理的结果必须能够得到固化。  

事务的隔离级别：  

1. Read Uncommitted（未提交读）：一个语句没有更新改变，但是其他语句可以读到这个改变。
2. Read Committed（已提交读）：语句提交之后，即执行了Commit之后别的事务可以能够读到这个改变，只能读到已经提交的数据。
3. Repeatable Read（可重复读）：在同一个事务里里面先后执行同一个查询语句的时候，得到的结果是一样的。
4. Serializable（穿行读）：这个事务执行的时候不允许别的事务并发执行。完全串行化的读，每次读都需要得到表级共享锁，读写相互都会阻塞。  

不对数据库进行并发控制，会出现以下异常：  

1. 脏读：当事务A读到事务B未提交的修改时，产生脏读。危险处在于B的修改可能会回滚。
2. 非重复读：一个事务对同一数据执行两次操作，结果不一样。同一查询在同一事务中多次进行，由于其他提交事务所做的修改或者删除，每次返回不同的结果。
3. 幻象读：事务在操作过程中进行两次查询操作，第二次的结果包含了第一次查询中未出现的数据（这里不要求两次查询的语句相同）。因为在两次查询过程中有另一个事务插入数据造成的。
4. 丢失修改：分为两种  
第一类：两个事务更新相同的数据源，如果第一个事务被提交，第二个事务被撤销，第一个事务连同第二个事务一同被撤销。  
第二类：两个并发事务操作同一数据，然后其中一个对它进行修改提交，而另一个也进行了修改提交。这样第一次修改失效。  

[这里有更详细的说明](http://www.cnblogs.com/tqsummer/archive/2010/07/11/1775209.html)

  




